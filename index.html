<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BitVen-Forca</title>
    <style>
        :root {
            --color-primary: #3b82f6;
            --color-secondary: #10b981;
            --color-danger: #ef4444;
            --color-text-dark: #1f2937;
            --color-text-light: #6b7280;
            --color-bg-light: #f9fafb;
            --color-bg-white: white;
            --border-radius-lg: 1rem;
        }

        body { 
            font-family: 'Inter', sans-serif; 
            background-color: var(--color-bg-light); 
            padding: 2.5rem; 
        }

        .container {
            max-width: 1280px;
            margin: 0 auto;
        }

        .card { 
            background-color: var(--color-bg-white); 
            border-radius: var(--border-radius-lg); 
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08); 
            padding: 24px;
        }

        .grid-layout {
            display: grid;
            grid-template-columns: 1fr;
            gap: 2rem;
        }
        @media (min-width: 1024px) {
            .grid-layout {
                grid-template-columns: 2fr 1fr;
            }
        }

        .admin-tag { 
            background-color: var(--color-danger); 
            color: white; 
            padding: 0.25rem 0.75rem; 
            border-radius: 9999px; 
            font-size: 0.75rem; 
            font-weight: bold; 
            display: inline-block;
        }
        
        .success { color: var(--color-secondary); }
        .danger { color: var(--color-danger); }
        
        .scrollable-content { 
            max-height: 400px; 
            overflow-y: auto; 
        }

        /* Form and Button Styling */
        .form-group { margin-bottom: 1rem; }
        .form-label { display: block; font-size: 0.875rem; font-weight: 500; color: var(--color-text-dark); margin-bottom: 0.25rem; }
        .form-input { 
            display: block; 
            width: 100%; 
            padding: 0.5rem; 
            border: 1px solid #d1d5db; 
            border-radius: 0.375rem; 
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            margin-top: 0.25rem;
        }
        
        .button { 
            width: 100%; 
            padding: 0.75rem; 
            border-radius: 0.5rem; 
            font-weight: 600; 
            color: white; 
            cursor: pointer; 
            transition: background-color 0.3s;
            border: none;
        }

        .button-primary { background-color: var(--color-secondary); }
        .button-primary:hover:enabled { background-color: #059669; }
        .button-danger { background-color: var(--color-danger); }
        .button-danger:hover:enabled { background-color: #dc2626; }
        .button:disabled { opacity: 0.5; cursor: not-allowed; }

        /* Modal Styling */
        .modal-backdrop {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background-color: rgba(0, 0, 0, 0.6); display: flex; 
            justify-content: center; align-items: center; z-index: 50; 
        }
        .modal-card { width: 90%; max-width: 400px; }

        /* Table Styling */
        .table { width: 100%; border-collapse: collapse; }
        .table th, .table td { padding: 10px; text-align: left; border-bottom: 1px solid #f3f4f6; }
        .table th { background-color: #f9fafb; font-size: 0.75rem; color: var(--color-text-light); text-transform: uppercase; letter-spacing: 0.05em; position: sticky; top: 0; }
        .table tr:hover { background-color: #f9fafb; }
        .text-truncate { overflow: hidden; white-space: nowrap; text-overflow: ellipsis; max-width: 150px; }
    </style>
</head>
<body>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, signOut, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot, collection, runTransaction, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        setLogLevel('Debug');

        // REQUIRED ADMIN IDENTITY
        const ADMIN_EMAIL = 'lanushomeappliances@gmail.com';
        const EXCHANGE_RATE_NGN = 1000.00; // 1 BVN = 1800 NGN

        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : undefined;
        
        let app = null;
        let db = null;
        let auth = null;
        let firebaseConfig = {};

        try {
            firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        } catch(e) {
            console.error("Error parsing __firebase_config:", e);
        }

        if (!firebaseConfig || !firebaseConfig.projectId) {
            // The logic to handle the error when the DOM is ready will be in initializeBitVen
            console.error("Firebase initialization aborted due to missing project ID.");
        } else {
            // Initialize Firebase only if config is valid
            app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            auth = getAuth(app);
        }
        
        let userId = null;
        let isAdmin = false;
        let profiles = {};
        let transactions = [];
        let balanceBVN = 0;

        const path = (collectionName, docId) => 
            docId ? 
            doc(db, 'artifacts', appId, 'public', 'data', collectionName, docId) : 
            collection(db, 'artifacts', appId, 'public', 'data', collectionName);

        // These variables can only be defined if db is defined, otherwise they will fail
        // Since db is conditionally defined, we handle the checks in the listener functions
        const profilesCollection = () => path('user_profiles_v2');
        const transactionsCollection = () => path('ledger_transactions_v3');
        const invoicesCollection = () => path('invoices_v2');


        const log = (message, type = 'log') => {
            const statusElement = document.getElementById('status-message');
            if (statusElement) {
                statusElement.textContent = message;
                statusElement.className = `p-3 rounded-lg text-sm mb-4 ${type === 'error' ? 'bg-red-100 text-red-700' : 'bg-green-100 text-green-700'}`;
                statusElement.style.backgroundColor = type === 'error' ? '#fee2e2' : '#d1fae5';
                statusElement.style.color = type === 'error' ? '#b91c1c' : '#065f46';
                statusElement.style.borderRadius = '0.5rem';
                statusElement.style.marginBottom = '1rem';
            }
            console.log(message);
        };

        const displayMessage = (text, type = 'info') => {
            const modal = document.createElement('div');
            modal.className = 'modal-backdrop';
            modal.innerHTML = `
                <div class="card modal-card p-6">
                    <h3 style="font-size: 1.25rem; font-weight: 700; margin-bottom: 1rem;">${type === 'error' ? 'Error' : 'Notification'}</h3>
                    <p style="color: var(--color-text-light);">${text}</p>
                    <button id="closeModal" class="button mt-6" style="background-color: ${type === 'error' ? 'var(--color-danger)' : 'var(--color-primary)'};">Close</button>
                </div>
            `;
            document.body.appendChild(modal);
            document.getElementById('closeModal').onclick = () => document.body.removeChild(modal);
        };

        // --- Core Data Structures ---

        function createTransaction(sender, recipient, amount, type, reference = '') {
            return {
                timestamp: Date.now(),
                sender: sender,
                recipient: recipient,
                amount: amount,
                type: type, // 'payment', 'fee', 'bonus'
                reference: reference
            };
        }

        // --- UI Renders ---

        const formatCurrency = (amount) => {
            const formatted = parseFloat(amount).toFixed(2);
            return `₦${(formatted * EXCHANGE_RATE_NGN).toLocaleString('en-NG', { minimumFractionDigits: 2 })}`;
        };

        const calculateAndDisplayBalance = () => {
            let tempBalance = 0;
            const myUid = userId;
            
            // ADMIN Privilege: Infinite Balance
            if (isAdmin) { 
                tempBalance = Infinity;
            } else {
                transactions.forEach(tx => {
                    if (tx.sender === myUid) {
                        tempBalance -= tx.amount;
                    }
                    if (tx.recipient === myUid) {
                        tempBalance += tx.amount;
                    }
                });
            }

            balanceBVN = tempBalance;

            const balanceBVNEl = document.getElementById('balance-bvn');
            const balanceNGNEl = document.getElementById('balance-ngn');
            const balanceStatusEl = document.getElementById('balance-status');
            const sendButton = document.getElementById('send-bvn-button');
            const issueButton = document.getElementById('issue-bvn-button');

            if (balanceBVNEl) balanceBVNEl.textContent = isAdmin ? '∞' : balanceBVN.toFixed(2);
            if (balanceNGNEl) balanceNGNEl.textContent = isAdmin ? 'ADMIN' : formatCurrency(balanceBVN);
            
            if (balanceStatusEl) {
                balanceStatusEl.textContent = isAdmin ? 'STATUS: ADMIN (Infinite)' : (balanceBVN >= 0 ? 'STATUS: Solvent' : 'STATUS: Overdrawn');
                balanceStatusEl.classList.toggle('success', balanceBVN >= 0 || isAdmin);
                balanceStatusEl.classList.toggle('danger', balanceBVN < 0 && !isAdmin);
            }

            if (sendButton) sendButton.disabled = !isAdmin && balanceBVN <= 0;
            if (issueButton) issueButton.disabled = !isAdmin;

            renderTransactionHistory();
            renderUserDirectory();
        };

        const renderTransactionHistory = () => {
            const historyBody = document.getElementById('transaction-history-body');
            if (!historyBody) return;

            historyBody.innerHTML = '';

            const sortedTransactions = [...transactions].sort((a, b) => b.timestamp - a.timestamp);

            sortedTransactions.forEach(tx => {
                const isSent = tx.sender === userId;
                const isReceived = tx.recipient === userId;
                const userReference = isSent ? (profiles[tx.recipient]?.email || tx.recipient) : (profiles[tx.sender]?.email || tx.sender);
                const amountText = tx.amount.toFixed(2);
                
                let direction, styleClass, icon;

                if (tx.type === 'bonus') {
                    direction = 'BONUS';
                    styleClass = 'text-yellow-600';
                    icon = '✨';
                } else if (isSent && tx.type === 'fee') {
                    direction = 'FEE';
                    styleClass = 'text-red-500';
                    icon = '⬇️';
                } else if (isSent) {
                    direction = `OUT to ${userReference}`;
                    styleClass = 'text-red-600';
                    icon = '⬇️';
                } else if (isReceived) {
                    direction = `IN from ${userReference}`;
                    styleClass = 'text-green-600';
                    icon = '⬆️';
                } else {
                    direction = 'N/A';
                    styleClass = 'text-gray-500';
                    icon = '';
                }

                const row = document.createElement('tr');
                row.className = 'border-b';
                row.innerHTML = `
                    <td class="table-cell" style="font-weight: 500;" class="${styleClass}">${icon} ${direction}</td>
                    <td class="table-cell ${styleClass}">${amountText} BVN</td>
                    <td class="table-cell" style="font-size: 0.75rem; color: var(--color-text-light);">${new Date(tx.timestamp).toLocaleString()}</td>
                    <td class="table-cell text-truncate" style="font-size: 0.75rem; color: #9ca3af;">${tx.sender} / ${tx.recipient}</td>
                `;
                historyBody.appendChild(row);
            });
        };

        const renderUserDirectory = () => {
            const directoryBody = document.getElementById('directory-body');
            if (!directoryBody) return;

            directoryBody.innerHTML = '';
            
            // Only list actual users with emails (or a valid UID in the map, filtering out the email index)
            const uniqueProfiles = Object.values(profiles).filter((value, index, self) => 
                index === self.findIndex((t) => (t.uid === value.uid)) && value.email
            );

            uniqueProfiles.forEach(profile => {
                const row = document.createElement('tr');
                row.className = 'border-b';
                row.innerHTML = `
                    <td class="table-cell" style="font-weight: 500;">${profile.email}</td>
                    <td class="table-cell text-truncate">${profile.uid}</td>
                    <td class="table-cell">${profile.isAdmin ? '<span class="admin-tag" style="background-color: var(--color-secondary);">ADMIN</span>' : 'User'}</td>
                `;
                directoryBody.appendChild(row);
            });
        };

        // --- Core Logic ---

        const saveUserProfile = async (uid, email, displayName, userIsAdmin) => {
            if (!db) return; // Guard against uninitialized database
            const profileRef = path('user_profiles_v2', uid);
            try {
                await setDoc(profileRef, {
                    uid,
                    email,
                    displayName,
                    isAdmin: userIsAdmin,
                    lastSeen: Date.now(),
                }, { merge: true });
            } catch (error) {
                log('Failed to save profile (Check Security Rules): ' + error.message, 'error');
            }
        };

        const authenticate = async () => {
            if (!auth) return; // Guard against uninitialized auth
            try {
                log('Attempting authentication...');
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    log('No initial auth token provided. User must manually sign in via Google.');
                    document.getElementById('sign-in-button').onclick = async () => {
                        const provider = new GoogleAuthProvider();
                        try {
                            await signInWithPopup(auth, provider);
                        } catch (e) {
                            log('Google Sign-in failed: ' + e.message, 'error');
                        }
                    };
                }
            } catch (error) {
                log('Authentication failed: ' + error.message, 'error');
            }
        };
        
        const handleAuthChange = async (user) => {
            const authStatusEl = document.getElementById('auth-status');
            const authDetailsEl = document.getElementById('auth-details');
            const signInButton = document.getElementById('sign-in-button');
            const signOutButton = document.getElementById('sign-out-button');
            const adminIssueCard = document.getElementById('admin-issue-card');

            if (user) {
                userId = user.uid;
                const email = user.email || 'Anonymous';
                
                const userIsAdmin = email === ADMIN_EMAIL;
                isAdmin = userIsAdmin;

                await saveUserProfile(user.uid, email, user.displayName || 'Unknown User', isAdmin);

                authStatusEl.textContent = 'Authenticated';
                authStatusEl.style.color = 'var(--color-secondary)';
                authStatusEl.style.fontWeight = 'bold';
                
                authDetailsEl.innerHTML = `
                    <p style="font-size: 0.75rem; color: var(--color-text-light);">UID: <span style="font-family: monospace;">${user.uid}</span></p>
                    <p style="font-size: 0.75rem; color: var(--color-text-light);">Email: ${email} ${isAdmin ? '<span class="admin-tag" style="background-color: var(--color-primary);">ADMIN</span>' : ''}</p>
                `;
                
                signInButton.style.display = 'none';
                signOutButton.style.display = 'inline-block';

                if (adminIssueCard) {
                    adminIssueCard.style.display = isAdmin ? 'block' : 'none';
                }

                startListeners();
                log(`User signed in. UID: ${user.uid}, Email: ${email}, Admin: ${isAdmin}`);

            } else {
                userId = null;
                isAdmin = false;
                authStatusEl.textContent = 'Signed Out';
                authStatusEl.style.color = 'var(--color-danger)';
                authDetailsEl.innerHTML = '<p style="font-size: 0.875rem; color: var(--color-text-light);">Please sign in to view and transact.</p>';
                
                signInButton.style.display = 'inline-block';
                signOutButton.style.display = 'none';

                if (adminIssueCard) adminIssueCard.style.display = 'none';

                profiles = {};
                transactions = [];
                balanceBVN = 0;
                calculateAndDisplayBalance();
            }
        };

        const sendBitVen = async (recipientId, amount) => {
            if (!db) return displayMessage('System not initialized. Cannot perform transaction.', 'error');
            const FEE_AMOUNT = 0.01;
            const totalDebit = parseFloat(amount) + FEE_AMOUNT;
            const amountFloat = parseFloat(amount);

            if (amountFloat <= 0) {
                displayMessage('Payment amount must be greater than zero.', 'error');
                return;
            }

            if (amountFloat < FEE_AMOUNT) {
                displayMessage('Payment must be at least 0.01 BVN to cover the network fee.', 'error');
                return;
            }
            
            if (!isAdmin && balanceBVN < totalDebit) {
                displayMessage(`Insufficient balance. Requires ${totalDebit.toFixed(2)} BVN (including 0.01 BVN fee). Current: ${balanceBVN.toFixed(2)} BVN`, 'error');
                return;
            }

            const sender = userId;
            const recipient = recipientId;
            const transactionRef = path('ledger_transactions_v3', 'TX' + Date.now() + Math.random().toString(36).substring(2, 9).toUpperCase());

            try {
                await runTransaction(db, async (transaction) => {
                    // 1. Core Payment Transaction
                    const paymentTx = createTransaction(sender, recipient, amountFloat, 'payment', 'P2P Transfer');
                    transaction.set(transactionRef, paymentTx);

                    // 2. Network Fee Transaction (sent from sender's account)
                    const feeTxRef = path('ledger_transactions_v3', 'FEE' + Date.now() + Math.random().toString(36).substring(2, 9).toUpperCase());
                    const feeTx = createTransaction(sender, sender, FEE_AMOUNT, 'fee', 'Network Fee');
                    transaction.set(feeTxRef, feeTx);
                });

                log(`Initiating instant payment: ${amountFloat} BVN from ${sender} to ${recipient}`);
                displayMessage(`Successfully sent ${amountFloat.toFixed(2)} BVN to ${profiles[recipient]?.email || recipient}. A ${FEE_AMOUNT.toFixed(2)} BVN network fee was applied.`);

            } catch (error) {
                log('Transaction failed: ' + error.message, 'error');
                displayMessage(`Transaction failed: ${error.message}`, 'error');
            }
        };

        const issueBitVen = async (recipientId, amount) => {
            if (!db) return displayMessage('System not initialized. Cannot perform issuance.', 'error');

            if (!isAdmin) {
                displayMessage('Only administrators can issue new BVN.', 'error');
                return;
            }
            const amountFloat = parseFloat(amount);
            if (amountFloat <= 0) {
                displayMessage('Issue amount must be greater than zero.', 'error');
                return;
            }

            const recipient = recipientId;
            const transactionRef = path('ledger_transactions_v3', 'ISSUE' + Date.now() + Math.random().toString(36).substring(2, 9).toUpperCase());

            try {
                await runTransaction(db, async (transaction) => {
                    // Sender is 'NETWORK' for issuance
                    const bonusTx = createTransaction('NETWORK', recipient, amountFloat, 'bonus', 'Admin Issue / Network Bonus');
                    transaction.set(transactionRef, bonusTx);
                });

                log(`Admin issued ${amountFloat} BVN to ${recipient}`);
                displayMessage(`Successfully issued ${amountFloat.toFixed(2)} BVN to ${profiles[recipient]?.email || recipient}.`);

            } catch (error) {
                log('Issue transaction failed: ' + error.message, 'error');
                displayMessage(`Issue transaction failed: ${error.message}`, 'error');
            }
        };

        // --- Firebase Listeners ---

        const startListeners = () => {
            if (!db) return; // Guard against uninitialized database

            // 1. Profile Listener
            onSnapshot(profilesCollection(), (snapshot) => {
                profiles = {};
                snapshot.forEach(doc => {
                    const profile = doc.data();
                    profiles[profile.uid] = profile;
                    if (profile.email) {
                        profiles[profile.email] = profile; 
                    }
                });
                log('User profiles snapshot received.');
                calculateAndDisplayBalance();
                renderUserDirectory();
            }, (error) => {
                log('Error listening to profiles: ' + error.message, 'error');
            });

            // 2. Transaction Log Listener
            onSnapshot(transactionsCollection(), (snapshot) => {
                transactions = [];
                snapshot.forEach(doc => {
                    transactions.push(doc.data());
                });
                log('Transaction log snapshot received.');
                calculateAndDisplayBalance();
                renderTransactionHistory();
            }, (error) => {
                log('Error listening to transactions: ' + error.message, 'error');
            });

            // 3. Invoices Listener (Placeholder)
            onSnapshot(invoicesCollection(), (snapshot) => {
                log('Invoices snapshot received.');
            }, (error) => {
                log('Error listening to invoices: ' + error.message, 'error');
            });
        };

        // --- Initial Setup ---

        const initializeBitVen = () => {
            // Check 1: If Firebase failed to initialize (invalid config)
            if (!auth || !db) {
                const signInButton = document.getElementById('sign-in-button');
                document.getElementById('status-message').innerHTML = '<span style="color:red; font-weight:bold;">Firebase Error: Project ID not configured. Sign-in disabled.</span>';
                
                if(signInButton) {
                    signInButton.disabled = true;
                    signInButton.textContent = "Config Error";
                    signInButton.style.backgroundColor = 'gray';
                }
                return; // Safe return inside a function
            }

            // Check 2: All good, proceed with Auth flow
            onAuthStateChanged(auth, handleAuthChange);
            authenticate();

            document.getElementById('send-bvn-form').addEventListener('submit', (e) => {
                e.preventDefault();
                const recipientEmailOrId = document.getElementById('recipient-id').value.trim();
                const amount = document.getElementById('send-amount').value.trim();
                
                const recipientProfile = profiles[recipientEmailOrId];
                const recipientId = recipientProfile ? recipientProfile.uid : recipientEmailOrId;

                sendBitVen(recipientId, amount);
                e.target.reset();
            });

            document.getElementById('issue-bvn-form').addEventListener('submit', (e) => {
                e.preventDefault();
                const recipientEmailOrId = document.getElementById('issue-recipient-id').value.trim();
                const amount = document.getElementById('issue-amount').value.trim();

                const recipientProfile = profiles[recipientEmailOrId];
                const recipientId = recipientProfile ? recipientProfile.uid : recipientEmailOrId;

                issueBitVen(recipientId, amount);
                e.target.reset();
            });

            document.getElementById('sign-out-button').addEventListener('click', () => {
                signOut(auth);
            });
        };

        window.onload = initializeBitVen;

    </script>

    <div class="container" style="padding: 1rem;">
        <header style="margin-bottom: 2rem;">
            <h1 style="font-size: 2.25rem; font-weight: 800; color: var(--color-text-dark); display: flex; align-items: center;">
                <span role="img" aria-label="Ven" style="margin-right: 0.5rem;">💰</span> BitVen System
            </h1>
            <p style="color: var(--color-text-light); margin-top: 0.25rem;">Instant, Transparent, Digital Transactions</p>
        </header>

        <div id="status-message" style="padding: 0.75rem; border-radius: 0.5rem; font-size: 0.875rem; margin-bottom: 1rem; background-color: #dbeafe; color: #1e40af;">Initializing...</div>

        <!-- Auth Status & Sign-In -->
        <div class="card" style="margin-bottom: 2rem; display: flex; flex-direction: column; justify-content: space-between; align-items: flex-start;">
            <div>
                <h2 style="font-size: 1.125rem; font-weight: 600; color: var(--color-text-dark);">Authentication Status</h2>
                <p id="auth-status" class="danger" style="font-weight: bold;">Signed Out</p>
                <div id="auth-details" style="margin-top: 0.5rem;">
                    <p style="font-size: 0.875rem; color: var(--color-text-light);">Please sign in to view and transact.</p>
                </div>
            </div>
            <div style="margin-top: 1rem; width: 100%; max-width: 200px;">
                <button id="sign-in-button" class="button" style="background-color: var(--color-primary);">Sign In with Google</button>
                <button id="sign-out-button" class="button button-danger" style="display: none;">Sign Out</button>
            </div>
        </div>

        <div class="grid-layout">
            
            <!-- Left Column: Wallet & Transactions -->
            <div style="grid-column: span 1 / span 1;">

                <!-- Wallet Card -->
                <div class="card" style="margin-bottom: 2rem;">
                    <h2 style="font-size: 1.5rem; font-weight: bold; color: var(--color-text-dark); margin-bottom: 1rem;">Your BitVen Wallet</h2>
                    <div style="display: flex; flex-direction: column; justify-content: space-between; align-items: center; background-color: var(--color-bg-light); padding: 1rem; border-radius: 0.5rem; border-left: 4px solid var(--color-primary);">
                        <div style="margin-bottom: 0.75rem;">
                            <p style="font-size: 0.875rem; color: var(--color-text-light);">Balance (BVN)</p>
                            <h3 id="balance-bvn" style="font-size: 2.25rem; font-weight: 800; color: var(--color-text-dark);">0.00</h3>
                        </div>
                        <div style="text-align: right; width: 100%;">
                            <p style="font-size: 0.875rem; color: var(--color-text-light);">Approximate Value (NGN)</p>
                            <h3 id="balance-ngn" style="font-size: 1.5rem; font-weight: bold; color: var(--color-text-dark);">₦0.00</h3>
                            <p id="balance-status" class="success" style="font-size: 0.875rem; margin-top: 0.25rem;">STATUS: Solvent</p>
                        </div>
                    </div>
                </div>

                <!-- Send Form -->
                <div class="card" style="margin-bottom: 2rem;">
                    <h2 style="font-size: 1.25rem; font-weight: bold; color: var(--color-text-dark); margin-bottom: 1rem;">Send BitVen (P2P)</h2>
                    <form id="send-bvn-form" style="display: flex; flex-direction: column; gap: 1rem;">
                        <div class="form-group">
                            <label for="recipient-id" class="form-label">Recipient Email or UID</label>
                            <input type="text" id="recipient-id" required class="form-input" placeholder="user@example.com or UID">
                        </div>
                        <div class="form-group">
                            <label for="send-amount" class="form-label">Amount (BVN)</label>
                            <input type="number" step="0.01" min="0.01" id="send-amount" required class="form-input" placeholder="e.g., 1.50">
                            <p style="font-size: 0.75rem; color: var(--color-text-light); margin-top: 0.25rem;">Note: A 0.01 BVN network fee applies to all P2P transactions.</p>
                        </div>
                        <button type="submit" id="send-bvn-button" class="button button-primary" disabled>
                            Send BVN
                        </button>
                    </form>
                </div>

                <!-- Admin Issue Form (Hidden by default, shown only for Admin) -->
                <div class="card" style="margin-bottom: 2rem; display: none;" id="admin-issue-card">
                    <h2 style="font-size: 1.25rem; font-weight: bold; color: var(--color-text-dark); margin-bottom: 1rem;">Admin: Issue New BVN</h2>
                    <form id="issue-bvn-form" style="display: flex; flex-direction: column; gap: 1rem;">
                        <div class="form-group">
                            <label for="issue-recipient-id" class="form-label">Recipient Email or UID</label>
                            <input type="text" id="issue-recipient-id" required class="form-input" placeholder="user@example.com or UID">
                        </div>
                        <div class="form-group">
                            <label for="issue-amount" class="form-label">Amount (BVN)</label>
                            <input type="number" step="0.01" min="0.01" id="issue-amount" required class="form-input" placeholder="e.g., 1000.00">
                        </div>
                        <button type="submit" id="issue-bvn-button" class="button button-danger" disabled>
                            Issue New BVN
                        </button>
                    </form>
                </div>

            </div>

            <!-- Right Column: History & Directory -->
            <div style="grid-column: span 1 / span 1;">

                <!-- Transaction History -->
                <div class="card" style="margin-bottom: 2rem;">
                    <h2 style="font-size: 1.25rem; font-weight: bold; color: var(--color-text-dark); margin-bottom: 1rem;">Transaction Log</h2>
                    <div class="scrollable-content">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th class="table-cell">Type / Contact</th>
                                    <th class="table-cell">Amount</th>
                                    <th class="table-cell">Time</th>
                                    <th class="table-cell">IDs</th>
                                </tr>
                            </thead>
                            <tbody id="transaction-history-body">
                                <!-- Transactions will be injected here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- User Directory -->
                <div class="card">
                    <h2 style="font-size: 1.25rem; font-weight: bold; color: var(--color-text-dark); margin-bottom: 1rem;">User Directory</h2>
                    <div class="scrollable-content">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th class="table-cell">Email</th>
                                    <th class="table-cell">UID</th>
                                    <th class="table-cell">Role</th>
                                </tr>
                            </thead>
                            <tbody id="directory-body">
                                <!-- Profiles will be injected here -->
                            </tbody>
                        </table>
                    </div>
                </div>

            </div>
        </div>
    </div>

</body>
</html>

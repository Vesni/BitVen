<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BitVen Instant System</title>
    <script type="module" src="https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js"></script>
    <script type="module" src="https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js"></script>
    <script type="module" src="https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #4f46e5;
            --secondary-color: #6366f1;
            --bg-light: #f9fafb;
            --bg-card: #ffffff;
            --text-dark: #1f2937;
            --text-muted: #6b7280;
            --radius-md: 0.5rem;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-light);
            color: var(--text-dark);
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 1rem;
        }
        header {
            background-color: var(--primary-color);
            color: white;
            padding: 1.5rem;
            border-radius: var(--radius-md);
            margin-bottom: 1rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        .grid-container {
            display: grid;
            gap: 1.5rem;
            grid-template-columns: 1fr;
        }
        @media (min-width: 768px) {
            .grid-container {
                grid-template-columns: 3fr 2fr;
            }
        }
        @media (min-width: 1024px) {
            .grid-container {
                grid-template-columns: 4fr 1.5fr 1.5fr;
            }
        }
        .card {
            background-color: var(--bg-card);
            padding: 1.5rem;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-sm);
            border: 1px solid #e5e7eb;
        }
        .h2-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--primary-color);
            border-bottom: 2px solid var(--secondary-color);
            padding-bottom: 0.5rem;
        }
        .input-group, .form-group {
            margin-bottom: 1rem;
        }
        input[type="text"], input[type="email"], input[type="number"], button, select {
            padding: 0.75rem 1rem;
            border-radius: var(--radius-md);
            border: 1px solid #d1d5db;
            width: 100%;
            box-sizing: border-box;
            transition: all 0.15s ease-in-out;
            font-size: 1rem;
        }
        input:focus, select:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.2);
        }
        button {
            cursor: pointer;
            font-weight: 600;
            color: white;
            background-color: var(--primary-color);
            border: none;
        }
        button:hover:not(:disabled) {
            background-color: var(--secondary-color);
        }
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        .btn-google {
            background-color: #db4437;
        }
        .btn-google:hover:not(:disabled) {
            background-color: #c33d31;
        }
        .message-box {
            padding: 1rem;
            border-radius: var(--radius-md);
            margin-top: 1rem;
            font-weight: 500;
            color: white;
        }
        .message-box.error {
            background-color: #ef4444;
        }
        .message-box.success {
            background-color: #10b981;
        }
        .transaction-list {
            list-style: none;
            padding: 0;
            max-height: 400px;
            overflow-y: auto;
        }
        .transaction-item {
            display: flex;
            justify-content: space-between;
            padding: 0.75rem 0;
            border-bottom: 1px dashed #e5e7eb;
            font-size: 0.9rem;
        }
        .transaction-item:last-child {
            border-bottom: none;
        }
        .amount.in { color: #10b981; font-weight: 600; }
        .amount.out { color: #ef4444; font-weight: 600; }
        .user-list {
            list-style: none;
            padding: 0;
            max-height: 500px;
            overflow-y: auto;
        }
        .user-item {
            padding: 0.75rem 0;
            border-bottom: 1px dashed #e5e7eb;
            font-size: 0.9rem;
        }
        .balance-display {
            font-size: 2rem;
            font-weight: 700;
            margin-top: 0.5rem;
            color: var(--primary-color);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1 style="font-size: 2.5rem; font-weight: 700;">BitVen Instant System</h1>
            <p style="font-size: 1.125rem; opacity: 0.9;">Real-Time P2P Payment System</p>
        </header>

        <div class="grid-container">
            <!-- Main Content (Balance, Transactions, Send Form) -->
            <div style="grid-column: 1 / -1;" id="main-content">
                <div class="grid-container" style="grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));">
                    
                    <!-- Balance Card -->
                    <div class="card">
                        <h2 class="h2-title">Your BVN Balance</h2>
                        <div id="balance-container" class="balance-display">
                            --.-- BVN
                        </div>
                        <p style="font-size: 0.875rem; color: var(--text-muted); margin-top: 0.5rem;">Total available balance for transactions.</p>
                    </div>

                    <!-- Send BVN Card -->
                    <div class="card" id="send-bvn-card">
                        <h2 class="h2-title">Send BVN</h2>
                        <form id="send-bvn-form">
                            <div class="form-group">
                                <label for="recipient-id" style="display: block; font-weight: 500; margin-bottom: 0.5rem;">Recipient Email or UID</label>
                                <input type="text" id="recipient-id" placeholder="user@example.com or user UID" required>
                            </div>
                            <div class="form-group">
                                <label for="send-amount" style="display: block; font-weight: 500; margin-bottom: 0.5rem;">Amount (BVN)</label>
                                <input type="number" id="send-amount" min="0.01" step="0.01" placeholder="Amount" required>
                            </div>
                            <button type="submit" id="send-button">Send Payment</button>
                        </form>
                    </div>

                    <!-- Admin Card (Hidden by default) -->
                    <div class="card" id="admin-card" style="display: none;">
                        <h2 class="h2-title" style="color: #ef4444; border-bottom-color: #fca5a5;">Admin Issue BVN</h2>
                        <form id="issue-bvn-form">
                            <div class="form-group">
                                <label for="issue-recipient-id" style="display: block; font-weight: 500; margin-bottom: 0.5rem;">Recipient UID (Full String)</label>
                                <select id="issue-recipient-id" required>
                                    <option value="">Select User</option>
                                    <!-- Options populated by JS -->
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="issue-amount" style="display: block; font-weight: 500; margin-bottom: 0.5rem;">Amount to Issue (BVN)</label>
                                <input type="number" id="issue-amount" min="1" step="1" placeholder="Amount" required>
                            </div>
                            <button type="submit" style="background-color: #ef4444;" id="issue-button">Issue New BVN</button>
                        </form>
                    </div>
                </div>
                
                <!-- Transaction Log -->
                <div class="card" style="margin-top: 1.5rem;">
                    <h2 class="h2-title">Transaction Log</h2>
                    <ul id="transaction-log" class="transaction-list">
                        <li style="text-align: center; color: var(--text-muted);">No transactions yet.</li>
                    </ul>
                </div>
            </div>

            <!-- Sidebars (User Directory, Auth Status) -->
            <div style="grid-column: 1 / -1; display: grid; gap: 1.5rem;" id="sidebars-container">
                
                <!-- Auth Status Card -->
                <div class="card" id="auth-status-card">
                    <h2 class="h2-title">Authentication Status</h2>
                    <div id="auth-info" style="font-size: 0.9rem;">
                        <p>Status: <span id="auth-status" style="font-weight: 600; color: #f97316;">Signed Out</span></p>
                        <p id="auth-uid" style="word-break: break-all;">UID: N/A</p>
                        <p id="auth-email">Email: N/A</p>
                        <p id="auth-admin" style="display: none; font-weight: 700; color: #ef4444;">Role: Administrator</p>
                    </div>
                    <button id="auth-button" style="margin-top: 1rem;" class="btn-google">Sign In with Google</button>
                    <div id="message-container"></div>
                </div>
                
                <!-- User Directory -->
                <div class="card">
                    <h2 class="h2-title">User Directory</h2>
                    <ul id="user-directory" class="user-list">
                        <li style="text-align: center; color: var(--text-muted);">Loading users...</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import { getFirestore, doc, setDoc, onSnapshot, collection, query, runTransaction, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    // --- CRITICAL CONFIGURATION START ---
    // The environment variables provided by the Canvas are __app_id, __firebase_config, and __initial_auth_token.

    const appId = "default-app-id"; // Overridden by environment
    const FIREBASE_CONFIG = {
        apiKey: "AIzaSyDWSebqVunmSzmw168fDZE_ePqoJ-_jsig",
        authDomain: "bitven-6d42c.firebaseapp.com",
        projectId: "bitven-6d42c",
        storageBucket: "bitven-6d42c.firebasestorage.app",
        messagingSenderId: "511584242303",
        appId: "1:511584242303:web:bdfeac7801c4d17b254d4a"
    };
    const INITIAL_AUTH_TOKEN = ""; // Overridden by environment

    // Use environment variables if they exist
    let firebaseConfig = FIREBASE_CONFIG;
    let initialAuthToken = INITIAL_AUTH_TOKEN;

    if (typeof __firebase_config !== 'undefined') {
        try {
            firebaseConfig = JSON.parse(__firebase_config);
        } catch (e) {
            console.error("Failed to parse __firebase_config:", e);
        }
    }
    if (typeof __initial_auth_token !== 'undefined') {
        initialAuthToken = __initial_auth_token;
    }

    // --- Global Variables ---
    let app, db, auth;
    let userId = null;
    let isAdmin = false;
    let currentBalance = 0;
    let profiles = {}; // Stores UID -> {name, email, uid}
    const ADMIN_EMAIL = 'lanushomeappliances@gmail.com';
    const COLLECTION_TXN = 'ledger_transactions_v3';
    const COLLECTION_PROFILES = 'user_profiles_v2';
    const PATH_BASE = `artifacts/${appId}/public/data`;
    const PATH_TXN = `${PATH_BASE}/${COLLECTION_TXN}`;
    const PATH_PROFILES = `${PATH_BASE}/${COLLECTION_PROFILES}`;
    const FEE_PERCENTAGE = 0.01; // 1% fee

    // --- Utility Functions ---

    function displayMessage(message, type) {
        const container = document.getElementById('message-container');
        container.innerHTML = `<div class="message-box ${type}">${message}</div>`;
        setTimeout(() => container.innerHTML = '', 5000);
    }

    function formatBVN(amount) {
        if (isAdmin && userId && document.getElementById('auth-email').textContent.includes(ADMIN_EMAIL)) {
            return '‚àû BVN';
        }
        return `${(amount || 0).toFixed(2)} BVN`;
    }

    function formatTimestamp(timestamp) {
        if (!timestamp) return 'N/A';
        const date = timestamp.toDate ? timestamp.toDate() : new Date(timestamp);
        return date.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' }) + ' ' + date.toLocaleDateString();
    }
    
    // --- Firestore Operations ---

    async function saveUserProfile(user) {
        const docRef = doc(db, PATH_PROFILES, user.uid);
        const profileData = {
            uid: user.uid,
            email: user.email,
            name: user.displayName || user.email,
            isAdmin: user.email === ADMIN_EMAIL,
            lastLogin: new Date()
        };
        try {
            await setDoc(docRef, profileData, { merge: true });
        } catch (error) {
            console.error("Failed to save profile (Check Security Rules):", error.message);
            displayMessage("Failed to save profile: Check Security Rules.", 'error');
        }
    }

    function setupListeners() {
        const txnRef = collection(db, PATH_TXN);
        const profileRef = collection(db, PATH_PROFILES);

        // Transaction Log Listener
        onSnapshot(txnRef, (snapshot) => {
            const transactions = [];
            let newBalance = 0;
            const logElement = document.getElementById('transaction-log');

            snapshot.docs.forEach(doc => {
                const data = doc.data();
                if (data.sender === userId || data.recipient === userId) {
                    transactions.push({ id: doc.id, ...data });
                }
            });

            // Sort by timestamp (most recent first)
            transactions.sort((a, b) => b.timestamp?.toDate() - a.timestamp?.toDate());
            
            // Calculate balance (only if not admin)
            if (!isAdmin) {
                transactions.forEach(tx => {
                    if (tx.recipient === userId) {
                        newBalance += tx.amount; // Incoming or fee return (for fee, sender=recipient)
                    } else if (tx.sender === userId) {
                        newBalance -= tx.amount; // Outgoing or fee deduction
                    }
                });
            } else {
                newBalance = Infinity; // Admin has infinite balance
            }

            currentBalance = newBalance;
            document.getElementById('balance-container').textContent = formatBVN(currentBalance);
            
            // Update Log UI
            logElement.innerHTML = '';
            if (transactions.length === 0) {
                logElement.innerHTML = '<li style="text-align: center; color: var(--text-muted);">No transactions yet.</li>';
                return;
            }

            transactions.forEach(tx => {
                let status, amountText, icon, counterparty;
                const isIncoming = tx.recipient === userId && tx.sender !== userId;
                const isOutgoing = tx.sender === userId && tx.recipient !== userId;
                const isFee = tx.type === 'fee' && tx.sender === userId && tx.recipient === userId;
                const isBonus = tx.type === 'bonus';
                
                if (isBonus && tx.recipient === userId) {
                    status = 'Issued by NETWORK';
                    amountText = `+${tx.amount.toFixed(2)}`;
                    icon = 'üéâ';
                    counterparty = 'NETWORK';
                } else if (isIncoming) {
                    status = `Received from ${profiles[tx.sender]?.name || 'Unknown User'}`;
                    amountText = `+${tx.amount.toFixed(2)}`;
                    icon = '‚¨áÔ∏è';
                    counterparty = profiles[tx.sender]?.email;
                } else if (isOutgoing) {
                    status = `Sent to ${profiles[tx.recipient]?.name || 'Unknown User'}`;
                    amountText = `-${tx.amount.toFixed(2)}`;
                    icon = '‚¨ÜÔ∏è';
                    counterparty = profiles[tx.recipient]?.email;
                } else if (isFee) {
                    status = `Fee for P2P transaction`;
                    amountText = `-${tx.amount.toFixed(2)}`;
                    icon = '‚öôÔ∏è';
                    counterparty = 'BitVen System';
                } else {
                    // This handles cases like NETWORK or unexpected transaction types
                    return; 
                }

                logElement.innerHTML += `
                    <li class="transaction-item">
                        <div>
                            <span style="margin-right: 0.5rem;">${icon}</span>
                            <span>${status}</span>
                            <div style="font-size: 0.75rem; color: var(--text-muted);">${formatTimestamp(tx.timestamp)}</div>
                        </div>
                        <span class="amount ${isIncoming || isBonus ? 'in' : 'out'}">
                            ${amountText} BVN
                        </span>
                    </li>
                `;
            });
            console.log("Transaction log snapshot received.");
        });

        // User Directory Listener
        onSnapshot(profileRef, (snapshot) => {
            const directoryElement = document.getElementById('user-directory');
            const adminRecipientSelect = document.getElementById('issue-recipient-id');
            const newProfiles = {};
            let directoryHTML = '';
            let adminOptionsHTML = '<option value="">Select User</option>';

            snapshot.docs.forEach(doc => {
                const data = doc.data();
                newProfiles[data.uid] = data;
                
                if (data.uid !== userId) {
                    directoryHTML += `
                        <li class="user-item">
                            <span style="font-weight: 600;">${data.name}</span>
                            <div style="font-size: 0.75rem; color: var(--text-muted); word-break: break-all;">${data.email}</div>
                            <div style="font-size: 0.75rem; color: #4b5563; word-break: break-all;">UID: ${data.uid}</div>
                        </li>
                    `;
                    adminOptionsHTML += `<option value="${data.uid}">${data.name} (${data.email})</option>`;
                }
            });

            profiles = newProfiles; 
            directoryElement.innerHTML = directoryHTML || '<li style="text-align: center; color: var(--text-muted);">No other users found.</li>';
            adminRecipientSelect.innerHTML = adminOptionsHTML;
            console.log("User profiles snapshot received.");
        });
    }
    
    // --- Core Transaction Logic ---

    // Handles P2P payments and the resulting fee deduction
    const sendBitVen = async (recipientId, amount) => {
        if (!userId || !db) {
            displayMessage("Not signed in.", 'error');
            return;
        }

        const numericAmount = parseFloat(amount);
        const fee = numericAmount * FEE_PERCENTAGE;
        const netAmount = numericAmount - fee;
        const totalDebit = numericAmount;

        if (totalDebit <= 0) {
            displayMessage("Amount must be positive.", 'error');
            return;
        }
        if (!isAdmin && currentBalance < totalDebit) {
            displayMessage("Insufficient funds.", 'error');
            return;
        }

        const sender = userId;
        const recipient = recipientId;

        // CRITICAL CHECK: Security rules prevent sender === recipient for 'payment' type.
        if (sender === recipient) {
             displayMessage("Cannot send payment to yourself. Use a different recipient.", 'error');
             return;
        }
        
        try {
            await runTransaction(db, async (transaction) => {
                const transactionsCollection = collection(db, PATH_TXN);
                
                // 1. PAYMENT TRANSACTION (P2P)
                // Transaction type 'payment' must have sender != recipient per security rules.
                const paymentTx = {
                    sender: sender,
                    recipient: recipient,
                    amount: netAmount,
                    type: 'payment',
                    timestamp: new Date()
                };
                transaction.set(doc(transactionsCollection), paymentTx);

                // 2. FEE TRANSACTION (Self-Transfer for Fee Deduction)
                // Transaction type 'fee' must have sender == recipient per security rules.
                const feeTx = {
                    sender: sender, // The user paying the fee
                    recipient: sender, // The user receiving the fee deduction
                    amount: fee,
                    type: 'fee',
                    timestamp: new Date()
                };
                transaction.set(doc(transactionsCollection), feeTx);
            });

            displayMessage(`Successfully sent ${netAmount.toFixed(2)} BVN to ${profiles[recipientId]?.name || recipientId}. Fee: ${fee.toFixed(2)} BVN.`, 'success');

        } catch (error) {
            console.error("Transaction failed:", error.message);
            displayMessage(`Transaction failed: ${error.message}`, 'error');
        }
    };
    
    // Handles NETWORK bonus issuance (Admin only)
    const issueBitVen = async (recipientId, amount) => {
        if (!isAdmin) {
            displayMessage("Authorization failed: Only the Admin can issue BVN.", 'error');
            return;
        }

        const numericAmount = parseFloat(amount);
        if (numericAmount <= 0) {
            displayMessage("Amount must be positive.", 'error');
            return;
        }
        
        try {
            const docRef = doc(collection(db, PATH_TXN));
            await setDoc(docRef, {
                sender: 'NETWORK',
                recipient: recipientId,
                amount: numericAmount,
                type: 'bonus',
                timestamp: new Date()
            });
            displayMessage(`Successfully issued ${numericAmount.toFixed(2)} BVN to ${profiles[recipientId]?.name || recipientId}.`, 'success');
        } catch (error) {
            console.error("Issue transaction failed:", error.message);
            displayMessage(`Issue transaction failed: ${error.message}`, 'error');
        }
    };

    // --- Authentication and Initialization ---
    
    const provider = new GoogleAuthProvider();

    const signIn = () => signInWithPopup(auth, provider);
    const signOutUser = () => signOut(auth);

    const handleAuthChange = async (user) => {
        const authStatusElement = document.getElementById('auth-status');
        const authUidElement = document.getElementById('auth-uid');
        const authEmailElement = document.getElementById('auth-email');
        const authAdminElement = document.getElementById('auth-admin');
        const authButton = document.getElementById('auth-button');

        authButton.disabled = true;

        if (user) {
            userId = user.uid;
            isAdmin = user.email === ADMIN_EMAIL;
            
            await saveUserProfile(user);

            authStatusElement.textContent = 'Authenticated';
            authStatusElement.style.color = '#10b981';
            authUidElement.textContent = `UID: ${user.uid}`;
            authEmailElement.textContent = `Email: ${user.email}`;
            
            if (isAdmin) {
                authAdminElement.style.display = 'block';
                document.getElementById('admin-card').style.display = 'block';
                document.getElementById('balance-container').textContent = '‚àû BVN';
            } else {
                authAdminElement.style.display = 'none';
                document.getElementById('admin-card').style.display = 'none';
            }

            authButton.textContent = 'Sign Out';
            authButton.onclick = signOutUser;
            setupListeners(); // Start real-time data listeners
        } else {
            // Signed out state
            userId = null;
            isAdmin = false;
            currentBalance = 0;

            authStatusElement.textContent = 'Signed Out';
            authStatusElement.style.color = '#f97316';
            authUidElement.textContent = 'UID: N/A';
            authEmailElement.textContent = 'Email: N/A';
            authAdminElement.style.display = 'none';
            document.getElementById('admin-card').style.display = 'none';
            document.getElementById('balance-container').textContent = '--.-- BVN';
            document.getElementById('transaction-log').innerHTML = '<li style="text-align: center; color: var(--text-muted);">Sign in to view your history.</li>';

            authButton.textContent = 'Sign In with Google';
            authButton.onclick = signIn;
        }

        authButton.disabled = false;
        document.getElementById('send-button').disabled = !user;
    };


    async function initializeBitVen() {
        console.log("Attempting authentication...");
        
        if (firebaseConfig.projectId && firebaseConfig.apiKey) {
            app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            auth = getAuth(app);
            // setLogLevel('debug'); // Uncomment for debugging
        } else {
            document.getElementById('auth-status').textContent = 'Error';
            document.getElementById('auth-status').style.color = '#ef4444';
            document.getElementById('auth-button').disabled = true;
            document.getElementById('auth-button').textContent = 'Config Error';
            displayMessage("Firebase initialization aborted due to missing project ID or API Key.", 'error');
            return;
        }

        if (initialAuthToken) {
            try {
                // If a custom token is provided by the environment, use it.
                await signInWithCustomToken(auth, initialAuthToken);
                console.log("Signed in with custom token.");
            } catch (error) {
                console.error("Custom token sign-in failed:", error);
                // Fallback to standard sign-in if custom token fails
                onAuthStateChanged(auth, handleAuthChange);
            }
        } else {
            console.log("No initial auth token provided. User must manually sign in via Google.");
            onAuthStateChanged(auth, handleAuthChange);
        }
        
        // --- Form Event Listeners ---
        
        // P2P Send Form
        document.getElementById('send-bvn-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const recipientInput = document.getElementById('recipient-id').value.trim();
            const amount = document.getElementById('send-amount').value.trim();
            const numericAmount = parseFloat(amount);

            if (isNaN(numericAmount) || numericAmount <= 0) {
                displayMessage("Please enter a valid amount.", 'error');
                return;
            }

            let recipientId = null;
            
            // 1. Look up recipient UID by email or use raw input as UID
            for (const uid in profiles) {
                // Prioritize finding by email, which is more user-friendly
                if (profiles[uid].email && profiles[uid].email.toLowerCase() === recipientInput.toLowerCase()) {
                    recipientId = uid;
                    break;
                }
                // Also check if the user directly entered a UID
                if (profiles[uid].uid === recipientInput) {
                    recipientId = uid;
                    break;
                }
            }

            if (recipientId && profiles[recipientId]) {
                sendBitVen(recipientId, numericAmount);
            } else {
                displayMessage(`Error: Could not find user with email/UID: ${recipientInput}.`, 'error');
            }
            e.target.reset();
        });

        // Admin Issue Form
        document.getElementById('issue-bvn-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const recipientId = document.getElementById('issue-recipient-id').value;
            const amount = document.getElementById('issue-amount').value;
            const numericAmount = parseFloat(amount);

            if (!recipientId) {
                displayMessage("Please select a recipient.", 'error');
                return;
            }
            if (isNaN(numericAmount) || numericAmount <= 0) {
                displayMessage("Please enter a valid amount.", 'error');
                return;
            }

            issueBitVen(recipientId, numericAmount);
            e.target.reset();
        });
    }

    initializeBitVen();
</script>
</body>
</html>
